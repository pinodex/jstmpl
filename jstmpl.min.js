/**
 * jstmpl
 * Simple JavaScript Templating Engine
 *
 * @author    Raphael Marco <pinodex@outlook.ph>
 * @link      http://pinodex.github.io
 * @license   MIT
 */
(function(){window.Jstmpl=function(a){String.prototype.trim||(String.prototype.trim=function(){return this.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")});this.options=a||{};this.context=this.options.context||document;this.fn={raw:function(f){return Jstmpl_Helpers.htmlUnescape(f)}};if(window.jstmpl_defaults){var g=Object.keys(window.jstmpl_defaults);for(a=g.length-1;0<=a;a--)this.options[g[a]]=window.jstmpl_defaults[g[a]]}if(this.options.fn)for(g=Object.keys(this.options.fn),a=g.length-1;0<=a;a--)this.fn[g[a]]=
this.options.fn[g[a]];this.regExp={forloops:RegExp("{% for (.*?) in (.*?) %}((.*?|\n)+?){% endfor %}","gm"),variables:RegExp("{{ ([^}]+) }}","gm")};this.template=function(f){return new Jstmpl_Template(this,f)};this.parseVariables=function(f,d){for(var b=f.match(this.regExp.variables)||[],a=b.length-1;0<=a;a--){var c=b[a].substr(3,b[a].length-6).split("|");c[0]=c[0].split(".");var h=d[c[0][0]];if(h){if(1<c[0].length)for(var e=1;e<c[0].length;e++)h?h=h[c[0][e]]:this.debug().error("Jstmpl: Variable %s from %s is not defined.",
c[0][e],c[0].join("."));b[a]=b[a].replace(/\|/g,"\\|");h=Jstmpl_Helpers.htmlEscape(h);if(1<c.length)for(e=c.length-1;1<=e;e--)c[e]&&(c[e]in this.fn?h=this.fn[c[e]](h):this.debug().error('Jstmpl: Function "%s" is not defined.',c[e]));f=f.replace(new RegExp(b[a],"gm"),h)}else this.debug().error("Jstmpl: Variable %s is not defined.",c[0].join("."))}return f};this.parseForloops=function(f,a){for(var b;null!=(b=this.regExp.forloops.exec(f));){var g=a[b[2]],c="";b[1]=b[1].split(",");if(1!=b[1].length&&
2!=b[1].length)this.debug().error('Jstmpl: Invalid variable count for "%s" for loop.',b[2]);else if(g){for(var h=Object.keys(g),e={},k=0;k<h.length;k++){var l=Object.prototype.toString.call(g);"[object Array]"==l&&(e[b[1][0]]=String(g[k]));"[object Object]"==l&&(e[b[1][0]]=String(h[k]));2==b[1].length&&(e[b[1][1]]=String(g[h[k]]));c+=this.parseVariables(b[3],e)}b[0]=b[0].replace(/\|/g,"\\|");f=f.replace(new RegExp(b[0],"gm"),c)}else this.debug().error("Jstmpl: Variable %s is not defined.",b[2])}return f};
this.addFunction=function(f,a){this.fn[f]=a};this.debug=function(){return this.options.debug?{log:function(){console.log.apply(console,arguments)},warn:function(){console.warn.apply(console,arguments)},error:function(){console.error.apply(console,arguments)}}:{log:function(){},warn:function(){},error:function(){}}}};window.Jstmpl_Template=function(a,g){this.jstmpl=a;this.elements=this.jstmpl.context.querySelectorAll('[data-template="'+g+'"]');this.render=function(a){a=a||{};a=this.parse(a);for(var d=
this.elements.length-1;0<=d;d--){var b;if(b=this.elements[d].getAttribute("data-target"))for(b=this.jstmpl.context.querySelectorAll(b),d=b.length-1;0<=d;d--)b[d].innerHTML=a;else this.elements[d].innerHTML=a}return this};this.parse=function(a){a=a||{};if(!this.elements.length)return null;var d=this.elements[0].innerHTML,d=this.jstmpl.parseForloops(d,a),d=this.jstmpl.parseVariables(d,a);return d.trim()};this.callback=function(a){a(this.elements)}};window.Jstmpl_Helpers={htmlEscape:function(a){return String(a).replace(/&/g,
"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&#39;").replace(/</g,"&lt;").replace(/>/g,"&gt;")},htmlUnescape:function(a){return String(a).replace(/&quot;/g,'"').replace(/&#39;/g,"'").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&")}}})();